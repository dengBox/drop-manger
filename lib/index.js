!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t="undefined"!=typeof globalThis?globalThis:t||self).DropManger=i()}(this,(function(){"use strict";var t=Object.prototype.toString;function i(){return navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)?"mobile":"pc"}function o(i){return"[object Object]"===t.call(i)}function e(i){var n,s,r=(n=i,"[object Array]"!==t.call(n)?o(i)?"object":"other":"array");if("array"===r)s=[];else{if("object"!==r)return i;s={}}if("array"===r)for(var a=0;a<i.length;a++)s.push(e(i[a]));else if("object"===r)for(var d in i)s[d]=e(i[d]);return s}var n="pc"===i()?{start:"mousedown",move:"mousemove",end:"mouseup"}:{start:"touchstart",move:"touchmove",end:"touchend"};function s(t){t.preventDefault()}function r(t,i,o){t.addEventListener(n[i],o,{passive:!1})}function a(t,i,o){t.removeEventListener(n[i],o)}!function(t,i){void 0===i&&(i={});var o=i.insertAt;if(t&&"undefined"!=typeof document){var e=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===o&&e.firstChild?e.insertBefore(n,e.firstChild):e.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}}("body{background-color:#000}#wrap{width:1000px;height:800px;margin:10px auto;-webkit-box-shadow:0 0 10px #eee;box-shadow:0 0 10px #eee;position:relative}#wrap .dropEl{width:100px;height:100px;border:1px solid red;cursor:pointer}#wrap .dropEl.dropEl:nth-child(2){border-color:#0f0}#wrap .dropEl.dropEl:nth-child(3){border-color:#00f}#wrap .boshen_active_drop{-webkit-transition:-webkit-box-shadow .3s;transition:-webkit-box-shadow .3s;transition:box-shadow .3s;transition:box-shadow .3s,-webkit-box-shadow .3s;-webkit-box-shadow:0 0 10px #0ff;box-shadow:0 0 10px #0ff}");var d={el:null,wrap:null,type:"position",useHtmlDrop:!1,activeClass:"boshen_active_drop",unit:"px",hook:{dropStart:function(){},dropMove:function(){},dropEnd:function(){}}};return function(){function n(t){this._os=i(),this.dropState="unstart",this.config=e(d),this.activePosition={mouse:{x:0,y:0},dom:{offX:0,offY:0,width:0,height:0}},this.bindEvent={start:this.dragStart.bind(this),move:this.dragMove.bind(this),end:this.dragEnd.bind(this)},this._init(t)}var h=n.prototype;return h._init=function(t){var i,o;t.el||(i="Please pass in the moving object",void 0===o&&(o=null),console["error"](i,o||"")),this.margeConfig(this.config,t),r(this.config.el||window,"start",this.bindEvent.start)},h.destory=function(){"unstart"!==this.dropState&&a(this.config.el||window,"start",this.bindEvent.start)},h.dragStart=function(t){if(s(t),!(t=this.changeEvent(t)).button||2!==t.button){r(window,"move",this.bindEvent.move),r(window,"end",this.bindEvent.end),this.dropState="start",this.activePosition.mouse={x:t.x,y:t.y},this.activePosition.dom=this.getPosition(this.config.el,this.config.wrap),this.config.el.classList.add(this.config.activeClass);var i=this.config.el.style;"position"===this.config.type?i.position||(this.config.el.style.position="absolute"):i.transform||(this.config.el.style.transform="matrix(1, 0, 0, 1, 0, 0)"),this.config.hook.dropStart()}},h.dragMove=function(t){s(t);var i=(t=this.changeEvent(t)).x-this.activePosition.mouse.x,o=t.y-this.activePosition.mouse.y,e=this.config.el.style;if("position"===this.config.type)i+=this.activePosition.dom.offX,o+=this.activePosition.dom.offY,e.left=this.converUnit(i),e.top=this.converUnit(o);else{var n=e.transform.slice(7,-1).split(",");e.transform="matrix(1, 0, 0, 1, "+(Number(n[4])+i)+", "+(Number(n[5])+o)+")",this.activePosition.mouse={x:t.x,y:t.y}}this.dropState="move",this.config.hook.dropMove()},h.dragEnd=function(t){s(t),t=this.changeEvent(t),a(window,"move",this.bindEvent.move),a(window,"end",this.bindEvent.end),this.dropState="end",this.config.el.classList.remove(this.config.activeClass),this.config.hook.dropEnd()},h.getPosition=function(t,i){var o=t.getBoundingClientRect(),e=i?i.getBoundingClientRect():{x:0,y:0,width:0,height:0};return{offX:o.x-e.x,offY:o.y-e.y,width:o.width,height:o.height}},h.margeConfig=function(i,e){var n=this;(o(i)?Object.keys(i):i).forEach((function(o){var s,r;s=o,"[object Array]"===(r=t.call(s))||"[object Object]"===r?n.margeConfig(i[o],e[o]):e[o]&&(i[o]=e[o])}))},h.converUnit=function(t,i){return void 0===i&&(i=this.config.unit),t+i},h.changeEvent=function(t){return"mobile"!==this._os?t:{x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY}},n}()}));
