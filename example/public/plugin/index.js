!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t="undefined"!=typeof globalThis?globalThis:t||self).DropManger=i()}(this,(function(){"use strict";var t=Object.prototype.toString;function i(){return navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)?"mobile":"pc"}function o(i){return"[object Object]"===t.call(i)}function n(i){var e,s,r=(e=i,"[object Array]"!==t.call(e)?o(i)?"object":"other":"array");if("array"===r)s=[];else{if("object"!==r)return i;s={}}if("array"===r)for(var c=0;c<i.length;c++)s.push(n(i[c]));else if("object"===r)for(var h in i)s[h]=n(i[h]);return s}var e="pc"===i()?{start:"mousedown",move:"mousemove",end:"mouseup"}:{start:"touchstart",move:"touchmove",end:"touchend"};function s(t){t.preventDefault()}function r(t,i,o){t.addEventListener(e[i],o,{passive:!1})}function c(t,i,o){t.removeEventListener(e[i],o)}var h={el:null,wrap:null,type:"position",useHtmlDrop:!1,noConsole:!1,activeClass:"boshen_active_drop",unit:"px",hook:{dropStart:function(t){t.config.noConsole},dropMove:function(t){t.config.noConsole},dropEnd:function(t){t.config.noConsole},rightClick:function(t){t.config.noConsole}}};return function(){function e(t){this._os=i(),this.dropState="unstart",this.config=n(h),this.activePosition={mouse:{x:0,y:0},dom:{offX:0,offY:0,width:0,height:0}},this.bindEvent={start:this.dragStart.bind(this),move:this.dragMove.bind(this),end:this.dragEnd.bind(this)},this._init(t)}var a=e.prototype;return a._init=function(t){var i,o;this.margeConfig(this.config,t),t.el||this.config.noConsole||(i="Please pass in the moving object",void 0===o&&(o=null),console["error"](i,o||"")),r(this.config.el||window,"start",this.bindEvent.start)},a.destory=function(){"unstart"!==this.dropState&&c(this.config.el||window,"start",this.bindEvent.start)},a.dragStart=function(t){s(t);var i=this.changeEvent(t);if(i.button&&2===i.button)this.config.hook.rightClick(this,i);else{r(window,"move",this.bindEvent.move),r(window,"end",this.bindEvent.end),this.dropState="start",this.activePosition.mouse={x:i.x,y:i.y},this.activePosition.dom=this.getPosition(this.config.el,this.config.wrap),this.config.el.classList.add(this.config.activeClass);var o=this.config.el.style;"position"===this.config.type?o.position||(this.config.el.style.position="absolute"):o.transform||(this.config.el.style.transform="matrix(1, 0, 0, 1, 0, 0)"),this.config.hook.dropStart(this,t)}},a.dragMove=function(t){s(t);var i=this.changeEvent(t),o=i.x-this.activePosition.mouse.x,n=i.y-this.activePosition.mouse.y,e=this.config.el.style;if("position"===this.config.type)o+=this.activePosition.dom.offX,n+=this.activePosition.dom.offY,e.left=this.converUnit(o),e.top=this.converUnit(n);else{var r=e.transform.slice(7,-1).split(",");e.transform="matrix(1, 0, 0, 1, "+(Number(r[4])+o)+", "+(Number(r[5])+n)+")",this.activePosition.mouse={x:i.x,y:i.y}}this.dropState="move",this.config.hook.dropMove(this,t)},a.dragEnd=function(t){s(t),c(window,"move",this.bindEvent.move),c(window,"end",this.bindEvent.end),this.dropState="end",this.config.el.classList.remove(this.config.activeClass),this.config.hook.dropEnd(this,t)},a.getPosition=function(t,i){var o=t.getBoundingClientRect(),n=i?i.getBoundingClientRect():{x:0,y:0,width:0,height:0};return{offX:o.x-n.x,offY:o.y-n.y,width:o.width,height:o.height}},a.margeConfig=function(i,n){var e=this,s=o(i);(s?Object.keys(i):i).forEach((function(o){var r,c;r=s?i[o]:o,"[object Array]"===(c=t.call(r))||"[object Object]"===c?e.margeConfig(i[o],n[o]):n[o]&&(i[o]=n[o])}))},a.converUnit=function(t,i){return void 0===i&&(i=this.config.unit),t+i},a.changeEvent=function(t){return"mobile"!==this._os?t:{x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY}},e}()}));
