!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t="undefined"!=typeof globalThis?globalThis:t||self).DropManger=i()}(this,(function(){"use strict";var t=Object.prototype.toString;function i(){return navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)?"mobile":"pc"}function o(i){return"[object Object]"===t.call(i)}function n(i){var e,s,r=(e=i,"[object Array]"!==t.call(e)?o(i)?"object":"other":"array");if("array"===r)s=[];else{if("object"!==r)return i;s={}}if("array"===r)for(var a=0;a<i.length;a++)s.push(n(i[a]));else if("object"===r)for(var c in i)s[c]=n(i[c]);return s}var e="pc"===i()?{start:"mousedown",move:"mousemove",end:"mouseup"}:{start:"touchstart",move:"touchmove",end:"touchend"};function s(t){t.preventDefault()}function r(t,i,o){t.addEventListener(e[i],o,{passive:!1})}function a(t,i,o){t.removeEventListener(e[i],o)}var c={el:null,wrap:null,type:"position",useHtmlDrop:!1,activeClass:"boshen_active_drop",unit:"px",hook:{dropStart:function(){},dropMove:function(){},dropEnd:function(){}}};return function(){function e(t){this._os=i(),this.dropState="unstart",this.config=n(c),this.activePosition={mouse:{x:0,y:0},dom:{offX:0,offY:0,width:0,height:0}},this.bindEvent={start:this.dragStart.bind(this),move:this.dragMove.bind(this),end:this.dragEnd.bind(this)},this._init(t)}var h=e.prototype;return h._init=function(t){var i,o;t.el||(i="Please pass in the moving object",void 0===o&&(o=null),console["error"](i,o||"")),this.margeConfig(this.config,t),r(this.config.el||window,"start",this.bindEvent.start)},h.destory=function(){"unstart"!==this.dropState&&a(this.config.el||window,"start",this.bindEvent.start)},h.dragStart=function(t){if(t.returnValue=!1,s(t),!(t=this.changeEvent(t)).button||2!==t.button){r(window,"move",this.bindEvent.move),r(window,"end",this.bindEvent.end),this.dropState="start",this.activePosition.mouse={x:t.x,y:t.y},this.activePosition.dom=this.getPosition(this.config.el,this.config.wrap),this.config.el.classList.add(this.config.activeClass);var i=this.config.el.style;"position"===this.config.type?i.position||(this.config.el.style.position="absolute"):i.transform||(this.config.el.style.transform="matrix(1, 0, 0, 1, 0, 0)"),this.config.hook.dropStart()}},h.dragMove=function(t){s(t);var i=(t=this.changeEvent(t)).x-this.activePosition.mouse.x,o=t.y-this.activePosition.mouse.y,n=this.config.el.style;if("position"===this.config.type)i+=this.activePosition.dom.offX,o+=this.activePosition.dom.offY,n.left=this.converUnit(i),n.top=this.converUnit(o);else{var e=n.transform.slice(7,-1).split(",");n.transform="matrix(1, 0, 0, 1, "+(Number(e[4])+i)+", "+(Number(e[5])+o)+")",this.activePosition.mouse={x:t.x,y:t.y}}this.dropState="move",this.config.hook.dropMove()},h.dragEnd=function(t){s(t),t=this.changeEvent(t),a(window,"move",this.bindEvent.move),a(window,"end",this.bindEvent.end),this.dropState="end",this.config.el.classList.remove(this.config.activeClass),this.config.hook.dropEnd()},h.getPosition=function(t,i){var o=t.getBoundingClientRect(),n=i?i.getBoundingClientRect():{x:0,y:0,width:0,height:0};return{offX:o.x-n.x,offY:o.y-n.y,width:o.width,height:o.height}},h.margeConfig=function(i,n){var e=this;(o(i)?Object.keys(i):i).forEach((function(o){var s,r;s=o,"[object Array]"===(r=t.call(s))||"[object Object]"===r?e.margeConfig(i[o],n[o]):n[o]&&(i[o]=n[o])}))},h.converUnit=function(t,i){return void 0===i&&(i=this.config.unit),t+i},h.changeEvent=function(t){return"mobile"!==this._os?t:{x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY}},e}()}));
